# To reproduce our work, run this script.
# We used MacOS 13.3.1 (a) with an R package environment managed by renv.
# We used R version 4.1.2.
# Make it work on each of our computers
try({setwd("~/Dropbox/fruitfly_organogenesis/analysis")}, silent = T)
try({setwd("~/Dropbox (CahanLab)/fruitfly_organogenesis/analysis")}, silent = T)
try({setwd("c:/Users/DAndrewLab/Desktop/fruitfly_organogenesis/analysis/")}, silent = T)
renv::activate()
ANALYSIS_VERSION = "v18" # Where to put output
# wildtype rep 3 is presented as wildtype stage 13-16 rep 2 in the manuscript
metadata = read.table(header = T, text=
"sample cellranger
wt_rep1 2021-10-27_scRNA_10x_3prime
wt_rep3 2022-08-11_scRNA_10x_3prime_CellRanger6.1.2
wt_early_rep1 2022-12-07_scRNA_10x_3prime_WT_early
wt_early_rep2 2022-12-13_scRNA_10x_3prime_WT_early2")
SAMPLE = "all"
source("R/set_up_environment.R")
TARGET_dir = file.path("results", ANALYSIS_VERSION, "x_chromosome_germ_cells")
##### compare the ratio and marker genes for germ cells ######
monocle3_obj = readRDS("results/v18/refined_wt_late_early_germ/monocle3_no_batch_correct_object.rds")
monocle3_obj@colData[clusters(monocle3_obj) == 1, 'subtypes'] = 'Unknown 1'
monocle3_obj@colData[clusters(monocle3_obj) == 3, 'subtypes'] = 'Unknown 2'
monocle3_obj@colData[clusters(monocle3_obj) == 5, 'subtypes'] = 'Early Germ Cells'
monocle3_obj@colData[clusters(monocle3_obj) == 6, 'subtypes'] = 'Interm. Germ Cells 1'
monocle3_obj@colData[clusters(monocle3_obj) == 2, 'subtypes'] = 'Interm. Germ Cells 2'
monocle3_obj@colData[clusters(monocle3_obj) == 4, 'subtypes'] = 'Late Germ Cells'
sheet_index_list = c(1, 2, 3, 4)
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip() +
theme_half_open()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 9)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
TARGET_dir
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 9, height = 9)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 8, height = 5)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
View(sex_marker_genes)
sex_marker_genes_1 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 1)
sex_marker_genes_2 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 3)
intersect(sex_marker_genes_1$gene_short_name, sex_marker_genes_2$gene_short_name)
sex_marker_genes_3 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 2)
sex_marker_genes_4 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 4)
intersect(sex_marker_genes_3$gene_short_name, sex_marker_genes_4$gene_short_name)
# plot out the intersecting female genes
sex_marker_genes_1 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 1)
sex_marker_genes_2 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 3)
female_genes = intersect(sex_marker_genes_1$gene_short_name, sex_marker_genes_2$gene_short_name)
monocle3::plot_genes_by_group(monocle3_obj, markers = female_genes, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0("female_intersecting_GC.png")), width = 8, height = 5)
sex_marker_genes_3 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 2)
sex_marker_genes_4 = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = 4)
male_genes = intersect(sex_marker_genes_3$gene_short_name, sex_marker_genes_4$gene_short_name)
monocle3::plot_genes_by_group(monocle3_obj, markers = male_genes, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0("male_intersecting_GC.png")), width = 8, height = 5)
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 10, height = 5)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 12, height = 5)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 12, height = 4)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 11, height = 3)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 11, height = 3.5)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 11, height = 4)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
sheet_index_list = c(1, 2, 3, 4)
for(sheet_index in sheet_index_list) {
if(sheet_index == 1) {
type = "sexed_female"
} else if(sheet_index == 2) {
type = "sexed_male"
} else if(sheet_index == 3) {
type = "unsexed_female"
} else if(sheet_index == 4) {
type = "unsexed_male"
}
sex_marker_genes = readxl::read_excel("accessory_data/sex_determining_genes/SupplementalTable_S4.xlsx", sheet = sheet_index)
monocle3::plot_genes_by_group(monocle3_obj, markers = sex_marker_genes$gene_short_name, group_cells_by = 'subtypes') + coord_flip()
ggsave(file.path(TARGET_dir, paste0(type, "_GC.png")), width = 11, height = 4.1)
monocle3::plot_cells(monocle3_obj, genes = as.vector(sex_marker_genes$gene_short_name), cell_size = 1, show_trajectory_graph = FALSE) +
theme(text = element_text(size = 32))
ggsave(file.path(TARGET_dir, paste0(type, "_UMAP_GC.png")), width = 20, height = 20)
}
